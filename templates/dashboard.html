<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <meta http-equiv="refresh" content="30" />
    <title>{{ current_symbol }} - è‡ªåŠ¨äºé’±Agent</title>
    <link
      href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/5.1.3/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      :root {
        /* --- æµ…è‰²ä¸»é¢˜é…è‰² (Light Mode) --- */
        --bg-body: #f3f4f6; /* æµ…ç°èƒŒæ™¯ */
        --bg-card: #ffffff; /* çº¯ç™½å¡ç‰‡ */
        --bg-hover: #f9fafb; /* æ‚¬åœå¾®ç™½ */

        --text-main: #1f2937; /* æ·±ç°ä¸»å­— */
        --text-sub: #6b7280; /* ä¸­ç°å‰¯å­— */
        --border-color: #e5e7eb; /* æµ…è¾¹æ¡† */

        /* çŠ¶æ€é¢œè‰² */
        --buy-color: #059669; /* æ¶¨/ä¹° (æ·±ç»¿) */
        --sell-color: #dc2626; /* è·Œ/å– (æ·±çº¢) */
        --real-mode: #b91c1c; /* å®ç›˜çº¢ */
        --strat-mode: #1d4ed8; /* ç­–ç•¥è“ */

        /* å¾½ç« èƒŒæ™¯ */
        --bg-buy: #d1fae5;
        --bg-sell: #fee2e2;
        --bg-real: #fef2f2;
        --bg-strat: #eff6ff;
      }

      body {
        background-color: var(--bg-body);
        color: var(--text-main);
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          "Helvetica Neue", Arial, sans-serif;
        font-size: 14px;
        -webkit-font-smoothing: antialiased;
      }

      /* å¯¼èˆªæ  */
      .navbar {
        background: var(--bg-card);
        border-bottom: 1px solid var(--border-color);
        padding: 12px 0;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.03);
      }
      .nav-brand {
        font-weight: 700;
        font-size: 1.25rem;
        color: var(--text-main);
        letter-spacing: -0.5px;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      /* çŠ¶æ€æ  */
      .status-bar {
        background: #fffbeb; /* æµ…é»„èƒŒæ™¯ï¼Œæé†’ä½œç”¨ */
        border-bottom: 1px solid #fcd34d;
        padding: 10px 0;
        color: #92400e;
        font-size: 0.85rem;
      }
      .live-indicator {
        display: inline-block;
        width: 8px;
        height: 8px;
        background-color: #10b981;
        border-radius: 50%;
        margin-right: 6px;
        animation: pulse 2s infinite;
      }
      @keyframes pulse {
        0% {
          opacity: 1;
        }
        50% {
          opacity: 0.4;
        }
        100% {
          opacity: 1;
        }
      }

      /* ä¸‹æ‹‰æ¡†ç¾åŒ– */
      .custom-select {
        background-color: var(--bg-card);
        color: var(--text-main);
        border: 1px solid var(--border-color);
        padding: 6px 12px;
        border-radius: 6px;
        outline: none;
        font-size: 0.9rem;
        cursor: pointer;
        transition: border-color 0.2s;
      }
      .custom-select:focus {
        border-color: #3b82f6;
        box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);
      }

      /* ä¸»å®¹å™¨ */
      .main-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 24px;
      }

      /* Agent å¡ç‰‡ */
      .agents-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(360px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }
      .agent-card {
        background: var(--bg-card);
        border: 1px solid var(--border-color);
        border-radius: 12px;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        transition:
          transform 0.2s,
          box-shadow 0.2s;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
      }
      .agent-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
      }
      .agent-header {
        padding: 14px 20px;
        border-bottom: 1px solid var(--border-color);
        background: #f9fafb; /* æµ…ç°è¡¨å¤´ */
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .agent-body {
        padding: 20px;
        display: flex;
        flex-direction: column;
        gap: 14px;
        flex-grow: 1;
      }
      .logic-box {
        background: #eff6ff; /* æµ…è“èƒŒæ™¯ */
        border-left: 4px solid #3b82f6;
        padding: 12px;
        border-radius: 4px;
        color: #1e40af;
        font-size: 0.9rem;
        margin-top: auto;
      }

      /* è®¢å•è¡¨æ ¼ */
      .table-card {
        background: var(--bg-card);
        border: 1px solid var(--border-color);
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
      }
      .table-header {
        padding: 16px 24px;
        border-bottom: 1px solid var(--border-color);
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: #fff;
      }

      .table {
        width: 100%;
        margin: 0;
        border-collapse: collapse;
      }
      .table th {
        text-align: left;
        padding: 12px 16px; /* å‡å°å†…è¾¹è·ï¼Œé˜²æ­¢æŒ¤å‹ */
        color: var(--text-sub);
        font-weight: 600;
        font-size: 0.8rem;
        text-transform: uppercase;
        border-bottom: 1px solid var(--border-color);
        background: #f9fafb;
        white-space: nowrap; /* è¡¨å¤´ä¸æ¢è¡Œ */
      }
      .table td {
        padding: 14px 16px; /* å‡å°å†…è¾¹è· */
        border-bottom: 1px solid var(--border-color);
        color: var(--text-main);
        vertical-align: middle;
      }
      .table tr:last-child td {
        border-bottom: none;
      }
      .table tbody tr:hover {
        background-color: var(--bg-hover);
      }

      /* PCç«¯å±…ä¸­å¯¹é½ç‰¹å®šåˆ— */
      @media (min-width: 769px) {
        .col-center {
          text-align: center !important;
        }
      }

      /* æ ‡ç­¾ä¸å¾½ç«  - æ ¸å¿ƒä¿®å¤ï¼šå¼ºåˆ¶ä¸æ¢è¡Œ */
      .badge-mode {
        font-size: 0.75rem;
        font-weight: 700;
        padding: 4px 8px;
        border-radius: 6px;
        letter-spacing: 0.5px;
        white-space: nowrap; /* âœ… å¼ºåˆ¶ä¸æ¢è¡Œï¼Œè§£å†³ç«–æ’é—®é¢˜ */
        display: inline-block;
      }
      .mode-real {
        color: var(--real-mode);
        background: var(--bg-real);
        border: 1px solid rgba(185, 28, 28, 0.1);
      }
      .mode-strat {
        color: var(--strat-mode);
        background: var(--bg-strat);
        border: 1px solid rgba(29, 78, 216, 0.1);
      }

      .tag-side {
        padding: 4px 10px;
        border-radius: 6px;
        font-weight: 600;
        font-size: 0.85rem;
        white-space: nowrap; /* âœ… å¼ºåˆ¶ä¸æ¢è¡Œ */
        display: inline-block;
      }
      .side-buy {
        color: var(--buy-color);
        background: var(--bg-buy);
      }
      .side-sell {
        color: var(--sell-color);
        background: var(--bg-sell);
      }

      /* ä»·æ ¼é«˜äº® */
      .price-val {
        font-family: "SF Mono", monospace;
        font-size: 1rem;
        font-weight: 600;
        color: #111827;
        white-space: nowrap;
      }

      .tp-sl-row {
        display: flex;
        gap: 12px;
        font-size: 0.85rem;
        margin-top: 4px;
        white-space: nowrap;
      }
      .label-mini {
        color: #9ca3af;
        font-size: 0.75rem;
        margin-right: 2px;
        font-weight: 600;
      }

      /* åˆ†é¡µæŒ‰é’® */
      .pagination {
        display: flex;
        gap: 6px;
        list-style: none;
        padding: 0;
        margin: 0;
      }
      .page-link {
        padding: 6px 12px;
        background: #fff;
        border: 1px solid var(--border-color);
        color: var(--text-main);
        text-decoration: none;
        border-radius: 6px;
        font-size: 0.9rem;
        transition: all 0.2s;
      }
      .page-link:hover:not(.disabled) {
        background: #f3f4f6;
        border-color: #d1d5db;
        color: #000;
      }
      .disabled {
        opacity: 0.5;
        pointer-events: none;
        background: #f9fafb;
      }

      /* --- ç§»åŠ¨ç«¯é€‚é… --- */
      @media (max-width: 768px) {
        .main-container {
          padding: 12px;
        }

        .table thead {
          display: none;
        }
        .table tr {
          display: block;
          border: 1px solid var(--border-color);
          margin-bottom: 16px;
          border-radius: 12px;
          background: #fff;
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        }
        .table td {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 12px 16px;
          border-bottom: 1px solid #f3f4f6;
          text-align: right;
        }
        .table td:last-child {
          border-bottom: none;
        }
        .table td::before {
          content: attr(data-label);
          color: var(--text-sub);
          font-weight: 600;
          font-size: 0.85rem;
          margin-right: 10px;
          text-align: left;
        }

        .nav-brand {
          font-size: 1.1rem;
        }
        .status-bar .d-flex {
          flex-direction: column;
          gap: 6px;
        }
      }
    </style>
  </head>
  <body>
    <nav class="navbar sticky-top">
      <div class="container-fluid main-container" style="padding: 0 24px">
        <div class="d-flex justify-content-between align-items-center w-100">
          <div class="nav-brand">ğŸ’¸ è‡ªåŠ¨äºé’±Agent</div>
          <div class="d-flex gap-2">
            <select
              class="custom-select"
              onchange="window.location.href = '?symbol=' + this.value"
            >
              {% for sym in symbols %} {% if sym == current_symbol %}
              <option value="{{ sym }}" selected>{{ sym }}</option>
              {% else %}
              <option value="{{ sym }}">{{ sym }}</option>
              {% endif %} {% endfor %}
            </select>
            <button
              class="btn btn-sm btn-outline-secondary"
              onclick="location.reload()"
              style="border-color: var(--border-color); color: var(--text-sub)"
            >
              â†»
            </button>
          </div>
        </div>
      </div>
    </nav>

    <div class="status-bar">
      <div class="container-fluid main-container" style="padding: 0 24px">
        <div class="d-flex justify-content-between flex-wrap gap-2">
          <div>
            <span class="live-indicator"></span>
            <strong>çŠ¶æ€:</strong> è¿è¡Œä¸­
            <span style="color: #d97706; margin: 0 8px">|</span>

            <strong>å½“å‰æ¨¡å¼:</strong>
            <span style="color: #b45309; font-weight: 700"
              >{{ symbol_mode }}</span
            >
            <span style="color: #d97706; margin: 0 8px">|</span>
            <strong>é¢‘ç‡:</strong>
            <span style="color: #047857; font-weight: 700"
              >{{ symbol_freq }}</span
            >
          </div>
          <div>
            <strong>é£æ§ç³»ç»Ÿ:</strong>
            <span style="color: #059669; font-weight: 700">å·²å¯åŠ¨</span>
          </div>
        </div>
      </div>
    </div>

    <div class="main-container">
      <div class="agents-grid">
        {% if agent_summaries %} {% for summary in agent_summaries %}
        <div class="agent-card">
          <div class="agent-header">
            <span style="font-weight: 700; font-size: 1rem; color: #111827"
              >ğŸ¤– {{ summary.agent_name or 'AI-Agent' }}</span
            >
            <span
              style="
                color: var(--text-sub);
                font-size: 0.85rem;
                font-family: monospace;
              "
            >
              {{ summary.timestamp.split(' ')[1] if ' ' in summary.timestamp
              else summary.timestamp }}
            </span>
          </div>
          <div class="agent-body">
            <div style="line-height: 1.6; color: #374151">
              {{ summary.content }}
            </div>
            <div class="logic-box">
              <div
                style="font-weight: 700; margin-bottom: 6px; font-size: 0.8rem"
              >
                ğŸ’¡ ç­–ç•¥æ€è·¯
              </div>
              {{ summary.strategy_logic }}
            </div>
          </div>
        </div>
        {% endfor %} {% else %}
        <div
          style="
            grid-column: 1/-1;
            text-align: center;
            padding: 60px;
            color: var(--text-sub);
            background: #fff;
            border-radius: 12px;
            border: 1px solid var(--border-color);
          "
        >
          æš‚æ— åˆ†ææ•°æ®ï¼Œæ­£åœ¨ç­‰å¾… Agent äºé’±...
        </div>
        {% endif %}
      </div>

      <div class="table-card">
        <div class="table-header">
          <span style="font-weight: 700; font-size: 1.1rem; color: #111827"
            >ğŸ“œ äºé’±æ—¥å¿—</span
          >
          <span class="badge bg-light text-dark border" style="font-weight: 600"
            >Total: {{ total_orders }}</span
          >
        </div>

        <div style="overflow-x: auto">
          <table class="table">
            <thead>
              <tr>
                <th width="100">æ—¶é—´</th>
                <th width="80" class="col-center">æ¨¡å¼</th>
                <th width="120">Agent</th>
                <th width="80" class="col-center">æ–¹å‘</th>
                <th width="140">ä»·æ ¼ / è§¦å‘</th>
                <th width="160">é£æ§ (æ­¢ç›ˆ/æ­¢æŸ)</th>
                <th>ç†ç”±</th>
                <th width="60" style="text-align: right">ID</th>
              </tr>
            </thead>
            <tbody>
              {% for order in orders %}
              <tr>
                <td data-label="æ—¶é—´">
                  <span
                    style="
                      font-family: monospace;
                      color: var(--text-sub);
                      font-size: 0.9rem;
                      white-space: nowrap;
                    "
                  >
                    {{ order.timestamp.split(' ')[1] if ' ' in order.timestamp
                    else order.timestamp }}
                  </span>
                </td>

                <td data-label="æ¨¡å¼" class="col-center">
                  {% if order.trade_mode == 'REAL' %}
                  <span class="badge-mode mode-real">å®ç›˜</span>
                  {% else %}
                  <span class="badge-mode mode-strat">ç­–ç•¥</span>
                  {% endif %}
                </td>

                <td data-label="Agent">
                  <span
                    style="
                      font-weight: 600;
                      color: #374151;
                      white-space: nowrap;
                    "
                    >{{ order.agent_name or 'System' }}</span
                  >
                </td>

                <td data-label="æ–¹å‘" class="col-center">
                  <span
                    class="tag-side {% if 'buy' in order.side|lower %}side-buy{% elif 'sell' in order.side|lower %}side-sell{% endif %}"
                  >
                    {{ order.side|upper }}
                  </span>
                </td>

                <td data-label="å…¥åœºä»·">
                  {% if order.trigger_price and order.trigger_price > 0 %}
                  <span
                    style="
                      color: #d97706;
                      font-weight: 600;
                      white-space: nowrap;
                    "
                    >âš¡ {{ order.trigger_price }}</span
                  >
                  {% else %}
                  <span class="price-val">{{ order.entry_price }}</span>
                  {% endif %}
                </td>

                <td data-label="é£æ§">
                  <div class="tp-sl-row">
                    <div>
                      <span class="label-mini">TP</span>
                      <span
                        style="font-weight: 600; color: {% if order.take_profit > 0 %}var(--buy-color){% else %}#9ca3af{% endif %}"
                      >
                        {{ order.take_profit if order.take_profit > 0 else '--'
                        }}
                      </span>
                    </div>
                    <div>
                      <span class="label-mini">SL</span>
                      <span
                        style="font-weight: 600; color: {% if order.stop_loss > 0 %}var(--sell-color){% else %}#9ca3af{% endif %}"
                      >
                        {{ order.stop_loss if order.stop_loss > 0 else '--' }}
                      </span>
                    </div>
                  </div>
                </td>

                <td data-label="ç†ç”±">
                  <div
                    style="
                      color: var(--text-sub);
                      font-size: 0.9rem;
                      min-width: 200px;
                    "
                  >
                    {{ order.reason }}
                  </div>
                </td>

                <td data-label="ID" style="text-align: right">
                  <small style="font-family: monospace; color: #9ca3af"
                    >#{{ order.id }}</small
                  >
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

        <div
          style="
            padding: 16px 24px;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
          "
        >
          <ul class="pagination">
            <li>
              <a
                href="?symbol={{current_symbol}}&page={{current_page-1}}"
                class="page-link {% if current_page <= 1 %}disabled{% endif %}"
                >ä¸Šä¸€é¡µ</a
              >
            </li>
            <li>
              <span class="page-link disabled"
                >{{ current_page }} / {{ total_pages }}</span
              >
            </li>
            <li>
              <a
                href="?symbol={{current_symbol}}&page={{current_page+1}}"
                class="page-link {% if current_page >= total_pages %}disabled{% endif %}"
                >ä¸‹ä¸€é¡µ</a
              >
            </li>
          </ul>
        </div>
      </div>
    </div>
  </body>
</html>
